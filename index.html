<script type="module">
    new Vue({
        el: '#app',
        data: {
            inputMessage: '',
            messages: [],
            typing: false,
        },
        methods: {
            async sendMessage() {
                if (this.inputMessage.trim() !== '') {
                    const userMessage = { role: "user", content: this.cleanUpLinks(this.inputMessage) };
                    this.inputMessage = '';
                    this.messages.push(userMessage);
                    
                    this.typing = true;

                    // Daftar kata kunci yang terkait dengan pertanyaan penciptaan
                    const keywords = ['siapa yang menciptakan', 'pencipta', 'siapa yang buat', 'siapa pemilik'];

                    // Daftar pengecualian kata kunci yang tidak masuk akal
                    const exclusionKeywords = ['tuhan', 'alam semesta', 'bumi', 'seisinya'];

                    if (this.containsExclusion(userMessage.content, exclusionKeywords)) {
                        // Jika ada kata kunci yang tidak masuk akal, balas dengan respons umum
                        const assistantMessage = "Maaf, saya tidak dapat memberikan jawaban terkait pertanyaan ini.";
                        this.messages.push({ role: "assistant", content: assistantMessage });
                        this.typing = false;
                    } else if (this.containsKeyword(userMessage.content, keywords)) {
                        // Jika pertanyaan terkait pencipta dan tidak dalam daftar pengecualian, balas dengan jawaban tentang pencipta
                        const assistantMessage = "Saya dibuat atau diciptakan oleh Raya Fadilla Azhar, bertima kasihlah kepadanya karena telah membuat saya dan membantu anda.";
                        this.messages.push({ role: "assistant", content: assistantMessage });
                        this.typing = false;
                    } else {
                        // Jika tidak ada kata kunci pencipta, kirim ke model AI
                        const data = await generateText(this.messages);
                        this.typing = false;
                        this.messages.push({ role: "assistant", content: this.cleanUpLinks(data) });
                    }
                }
            },
            cleanUpLinks(message) {
                return message.replace(/(https?:\/\/[^\s]+)\s+/g, '$1').replace(/\s+(com|org|net|id|co)/g, '$1');
            },
            formatMessageContent(content) {
                // Wrap content into proper HTML tags for better readability
                return content.replace(/\n/g, '<br>').replace(/(\d\.\s)/g, '<ul><li>$1</li></ul>');
            },
            containsKeyword(message, keywords) {
                const lowercaseMessage = message.toLowerCase();
                return keywords.some(keyword => lowercaseMessage.includes(keyword));
            },
            containsExclusion(message, exclusionKeywords) {
                const lowercaseMessage = message.toLowerCase();
                return exclusionKeywords.some(keyword => lowercaseMessage.includes(keyword));
            },
            copyToClipboard(content) {
                const el = document.createElement('textarea');
                el.value = content;
                document.body.appendChild(el);
                el.select();
                document.execCommand('copy');
                document.body.removeChild(el);
                alert('Pesan berhasil disalin!');
            }
        }
    });

    async function generateText(messages) {
        const { HfInference } = await import('https://esm.sh/@huggingface/inference');
        const hf = new HfInference('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');

        const response = await hf.chatCompletion({
            model: "mistralai/Mixtral-8x7B-Instruct-v0.1",
            messages: messages,
            max_tokens: 500,
            temperature: 0.3,
            seed: 0,
        });

        return response.choices[0].message.content;
    }
                    </script>
                    
