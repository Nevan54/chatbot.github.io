<script type="module">
    new Vue({
        el: '#app',
        data: {
            inputMessage: '',
            messages: []
        },
        methods: {
            async sendMessage() {
                if (this.inputMessage.trim() !== '') {
                    const userMessage = { role: 'user', content: this.inputMessage };
                    this.messages.push(userMessage);
                    this.inputMessage = '';

                    const assistantMessage = await this.generateText(this.messages);
                    this.messages.push({ 
                        role: 'assistant', 
                        content: assistantMessage, 
                        isCode: this.isCode(assistantMessage) 
                    });
                }
            },

            isCode(text) {
                // Deteksi apakah teks adalah kode dengan pola tertentu, misalnya memiliki tanda ``` di dalam teks.
                return text.includes('```');
            },

            copyScript(content) {
                // Format script tanpa bahasa dan tanpa tanda ```
                const scriptContent = content.replace(/```(\w+)?\n|```/g, '').trim();
                navigator.clipboard.writeText(scriptContent).then(() => {
                    alert('Script disalin ke clipboard');
                }).catch(err => {
                    console.error('Gagal menyalin script:', err);
                });
            },

            copyFullMessage(message) {
                // Hilangkan ``` dan bahasa program dari konten kode untuk salinan penuh
                let fullMessage = message.content;

                if (message.isCode) {
                    // Hanya jika ada bagian kode, lakukan penghapusan karakter ``` untuk penyalinan pesan keseluruhan.
                    fullMessage = fullMessage.replace(/```(\w+)?\n|```/g, '').trim();
                }

                navigator.clipboard.writeText(fullMessage).then(() => {
                    alert('Pesan disalin ke clipboard');
                }).catch(err => {
                    console.error('Gagal menyalin pesan:', err);
                });
            },

            async generateText(messages) {
                const { HfInference } = await import('https://esm.sh/@huggingface/inference');
                const hf = new HfInference('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');

                const response = await hf.chatCompletion({
                    model: "mistralai/Mixtral-8x7B-Instruct-v0.1",
                    messages: messages,
                    max_tokens: 500,
                    temperature: 0.3,
                    seed: 0,
                });

                return response.choices[0].message.content;
            }
        }
    });
</script>
